<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ù„ÙˆØ­Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© - ØµØ§Ù„ÙˆÙ† Ù„Ù…Ø³Ø© Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ©</title>

<!-- SheetJS -->
<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

<style>
body {
    font-family: 'Cairo', sans-serif;
    margin: 0;
    padding: 0;
    background: #111;
    color: #fff;
}
.container {
    max-width: 1200px;
    margin: 30px auto;
    padding: 25px;
    background: #1a1a1a;
    border-radius: 15px;
    box-shadow: 0 0 25px rgba(255, 215, 0, 0.2);
}
h2 {
    text-align: center;
    color: gold;
    margin-bottom: 25px;
    font-size: 2.2rem;
    text-shadow: 0 0 10px gold;
}
.controls {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 12px;
    margin-bottom: 20px;
}
select, input[type="date"], input[type="text"] {
    padding: 10px;
    border-radius: 8px;
    border: none;
    font-size: 0.95rem;
    min-width: 150px;
    background: #222;
    color: #fff;
}
button {
    padding: 10px 16px;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
    font-size: 0.95rem;
    transition: all 0.3s ease;
}
button:hover {
    transform: translateY(-2px);
    box-shadow: 0 0 15px gold;
}
.btn-filter { background: #008cff; color: #fff; }
.btn-clear { background: #555; color: #fff; }
.btn-excel { background: gold; color: #111; }
.btn-delete { background: #b50000; color: #fff; }

.import-box {
    margin-top: 10px;
    text-align: center;
}
#importFile {
    padding: 8px;
    border-radius: 8px;
    background: #222;
    color: #fff;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    border-radius: 12px;
    overflow: hidden;
    font-size: 0.95rem;
    background: #222;
}
thead th {
    background: #1c1c1c;
    color: gold;
    padding: 14px 10px;
    font-weight: bold;
    text-align: center;
    text-shadow: 0 0 5px gold;
}
tbody td {
    padding: 12px 10px;
    text-align: center;
    border-bottom: 1px solid #333;
}
tbody tr {
    transition: all 0.3s ease;
}
tbody tr:hover {
    background: rgba(255, 215, 0, 0.15);
}
.row-old { background: #3a0000; }
.row-today { background: #2d2a00; }
.row-future { background: #003a00; }

#search {
    padding: 10px;
    border-radius: 8px;
    border: none;
    min-width: 200px;
    background: #222;
    color: #fff;
    font-size: 0.95rem;
}

@media (max-width: 768px) {
    .controls { flex-direction: column; gap: 10px; align-items: center; }
    select, input, button { min-width: 100%; }
}
</style>
</head>
<body>

<div class="container">
    <h2>ğŸ“‹ Ù„ÙˆØ­Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</h2>

    <div class="controls">
        <select id="filterBarber">
            <option value="">ÙƒÙ„ Ø§Ù„Ø­Ù„Ø§Ù‚ÙŠÙ†</option>
            <option value="Ø§Ù„Ø³ÙŠØ¯">Ø§Ù„Ø³ÙŠØ¯</option>
            <option value="Ù…Ø­Ù…Ø¯">Ù…Ø­Ù…Ø¯</option>
            <option value="Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡">Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡</option>
            <option value="Ø³Ù…ÙŠØ±">Ø³Ù…ÙŠØ±</option>
        </select>

        <input type="date" id="filterDate">
        <button class="btn-filter" onclick="applyFilter()">ØªØµÙÙŠØ©</button>
        <button class="btn-clear" onclick="clearFilter()">Ø¥Ù„ØºØ§Ø¡</button>
    </div>

    <div class="controls">
        <input type="text" id="search" placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¬ÙˆØ§Ù„" oninput="loadTable()">
        <button class="btn-delete" onclick="deleteAll()">ğŸ—‘ Ø­Ø°Ù Ø§Ù„ÙƒÙ„</button>
        <button class="btn-excel" onclick="exportExcel()">ğŸ“ ØªØµØ¯ÙŠØ± Excel</button>
    </div>

    <div class="import-box">
        <label>ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Excel: </label>
        <input type="file" id="importFile" onchange="importExcel()">
    </div>

    <table id="bookingTable">
        <thead>
            <tr>
                <th>#</th>
                <th>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                <th>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</th>
                <th>Ø§Ù„Ø­Ù„Ø§Ù‚</th>
                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                <th>Ø§Ù„ÙŠÙˆÙ…</th>
                <th>Ø§Ù„ÙˆÙ‚Øª</th>
                <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>
let bookedAppointments = {
    "Ø§Ù„Ø³ÙŠØ¯": [], "Ù…Ø­Ù…Ø¯": [], "Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡": [], "Ø³Ù…ÙŠØ±": []
};

// ØªØ­Ù…ÙŠÙ„ ÙˆØ­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
function loadBookingsFromStorage() {
    const saved = localStorage.getItem("barberBookings");
    if(saved) bookedAppointments = JSON.parse(saved);
}
function saveBookings() { localStorage.setItem("barberBookings", JSON.stringify(bookedAppointments)); }

let currentFilter = { barber:"", date:"" };

// Ø¯Ø§Ù„Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙˆÙ… Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
function getDayName(dateString){
    const days = ["Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡","Ø§Ù„Ø®Ù…ÙŠØ³","Ø§Ù„Ø¬Ù…Ø¹Ø©","Ø§Ù„Ø³Ø¨Øª"];
    const d = new Date(dateString + "T00:00:00");
    return days[d.getDay()];
}

// ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„
function loadTable(){
    loadBookingsFromStorage();
    for(const barber in bookedAppointments){
        bookedAppointments[barber].sort((a,b) => (b.date + b.time) > (a.date + a.time) ? 1 : -1);
    }

    const tbody = document.querySelector("#bookingTable tbody");
    tbody.innerHTML = "";

    const searchQuery = (document.getElementById("search")?.value || "").trim().toLowerCase();
    let rowCounter = 1;
    const today = new Date().toISOString().split("T")[0];

    for(const barber in bookedAppointments){
        bookedAppointments[barber].forEach((b,index) => {
            if(currentFilter.barber && currentFilter.barber !== barber) return;
            if(currentFilter.date && currentFilter.date !== b.date) return;
            if(searchQuery && !(`${b.name} ${b.phone}`.toLowerCase().includes(searchQuery))) return;

            let rowClass = "";
            if(b.date < today) rowClass = "row-old";
            else if(b.date === today) rowClass = "row-today";
            else rowClass = "row-future";

            const hour = parseInt(b.time.split(":")[0]);
            const period = hour < 12 ? "ØµØ¨Ø§Ø­Ø§Ù‹" : "Ù…Ø³Ø§Ø¡Ù‹";
            const dayName = getDayName(b.date);

            const tr = document.createElement("tr");
            tr.className = rowClass;
            tr.innerHTML = `
                <td>${rowCounter++}</td>
                <td>${b.name}</td>
                <td>${b.phone}</td>
                <td>${barber}</td>
                <td>${b.date}</td>
                <td>${dayName}</td>
                <td>${b.time} ${period}</td>
                <td><button class="btn-delete" onclick="deleteBooking('${barber}',${index})">Ø­Ø°Ù</button></td>
            `;
            tbody.appendChild(tr);
        });
    }
}

// Ø­Ø°Ù
function deleteBooking(barber,index){
    if(!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø²ØŸ")) return;
    bookedAppointments[barber].splice(index,1);
    saveBookings();
    loadTable();
}

// Ø­Ø°Ù Ø§Ù„ÙƒÙ„
function deleteAll(){
    if(!confirm("âš  Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§ØªØŸ")) return;
    bookedAppointments = { "Ø§Ù„Ø³ÙŠØ¯": [], "Ù…Ø­Ù…Ø¯": [], "Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡": [], "Ø³Ù…ÙŠØ±": [] };
    saveBookings();
    loadTable();
}

// ÙÙ„Ø§ØªØ±
function applyFilter(){
    currentFilter.barber = document.getElementById("filterBarber").value;
    currentFilter.date = document.getElementById("filterDate").value;
    loadTable();
}
function clearFilter(){
    currentFilter = { barber:"", date:"" };
    document.getElementById("filterBarber").value = "";
    document.getElementById("filterDate").value = "";
    loadTable();
}

// ØªØµØ¯ÙŠØ± Excel
function exportExcel(){
    let rows = [["#","Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„","Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„","Ø§Ù„Ø­Ù„Ø§Ù‚","Ø§Ù„ØªØ§Ø±ÙŠØ®","Ø§Ù„ÙŠÙˆÙ…","Ø§Ù„ÙˆÙ‚Øª"]];
    let counter = 1;

    for(const barber in bookedAppointments){
        bookedAppointments[barber].forEach(b => {
            if(currentFilter.barber && currentFilter.barber !== barber) return;
            if(currentFilter.date && currentFilter.date !== b.date) return;

            const hour = parseInt(b.time.split(":")[0]);
            const period = hour < 12 ? "ØµØ¨Ø§Ø­Ø§Ù‹" : "Ù…Ø³Ø§Ø¡Ù‹";
            const dayName = getDayName(b.date);

            rows.push([counter++, b.name, b.phone, barber, b.date, dayName, `${b.time} ${period}`]);
        });
    }

    const worksheet = XLSX.utils.aoa_to_sheet(rows);
    const workbook = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(workbook, worksheet, "Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª");
    XLSX.writeFile(workbook, "Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª.xlsx");
}

// Ø§Ø³ØªÙŠØ±Ø§Ø¯ Excel
function importExcel(){
    const input = document.getElementById("importFile");
    const file = input.files[0];
    if(!file) return;

    const reader = new FileReader();
    reader.onload = function(e){
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, {type:'array'});
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const rows = XLSX.utils.sheet_to_json(sheet);

        for(const row of rows){
            if(!bookedAppointments[row["Ø§Ù„Ø­Ù„Ø§Ù‚"]]) continue;
            bookedAppointments[row["Ø§Ù„Ø­Ù„Ø§Ù‚"]].push({
                name: row["Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„"],
                phone: row["Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„"],
                date: row["Ø§Ù„ØªØ§Ø±ÙŠØ®"],
                time: row["Ø§Ù„ÙˆÙ‚Øª"].split(" ")[0]
            });
        }

        saveBookings();
        loadTable();
        alert("ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!");
    };

    reader.readAsArrayBuffer(file);
}

loadTable();
</script>

</body>
</html>
